#include "BareBonesOS/src/bbos.inc.asm"

org 0

loop:
read_char:
  SET A, 0x3001   ; Read Char
  SET PUSH, 1     ; block and wait for a key to be pressed
  INT 0x4743      ; invoke BBOS
  SET B, POP      ; get result and store in B

print_char:
  AND B, 0x007F   ; Unset the 9 MSBits
  SET A, 0x1003   ; Write Char
  SET PUSH, B     ; Push character to be written to screen
  SET PUSH, 1     ; Auto increase cursor position
  INT 0x4743      ; invoke BBOS
  ADD SP, 2       ; clean up stack

check_overflow:
  ;SET A, 0x1002   ; Get Cursor pos
  ;IFG 2, POP
  ;  SET PC, reset_cursor

  ;SET PC, loop

reset_cursor:
  ;ADD SP, 1
  SET PUSH, 1
  SET PUSH, 1
  INT 0x1001       ; Set cursor at 0,0
  ADD SP, 2       ; clean up stack

  SET PC, loop

end_program: .dat 0

; DASM not support yet filling with 0s


.fill 0, 0x1FE - end_program
;org 0x1FE
.dat 0x55AA     ; Magic number
